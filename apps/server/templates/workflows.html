{% extends 'base.html' %}
{% block content %}
<h2>Workflows</h2>
<div style="margin:6px 0"><input id="wfToken" placeholder="Admin Token(可选)" style="max-width:240px"></div>
<form method="post" action="/api/workflows" id="wfForm">
  <label>名称: <input name="name" required></label><br>
  <label>定义(JSON):<br>
    <textarea name="definition_json" style="width:100%;height:160px">{
  "action": {"type": "run", "args": {"srs_path": "examples/srs/weekly_report.json", "data_path": "examples/data/weekly.csv", "out": "reports/weekly_report.md", "planner": "llm", "executor": "llm", "critic": "llm", "reviser": "llm"}}
}</textarea>
  </label><br>
  <button type="submit">保存工作流</button>
  <span id="wfHint" style="margin-left:8px;color:#666"></span>
</form>
<h3>已有工作流</h3>
<table>
  <thead><tr><th>ID</th><th>名称</th><th>创建时间</th><th>操作</th></tr></thead>
  <tbody>
  {% for w in wfs %}
    <tr><td>{{w.id}}</td><td>{{w.name}}</td><td>{{w.created_ts}}</td><td><a href="/workflows/{{w.id}}">详情</a></td></tr>
  {% endfor %}
  </tbody>
</table>
<script>
const f=document.getElementById('wfForm'); const h=document.getElementById('wfHint'); const t=document.getElementById('wfToken');
f.addEventListener('submit', async (e)=>{
  e.preventDefault(); const fd=new FormData(f);
  const headers={}; if(t.value) headers['X-Admin-Token']=t.value;
  const r=await fetch(f.action,{method:'POST',body:fd, headers});
  const d=await r.json(); h.textContent=d.ok?'已保存 ID='+d.id:'保存失败';
});
</script>
{% endblock %}
