# agents相关文档查看 CLAUDE.md

# 使用中文和我交流

该文件同时作为后续 TODO 清单的存放处。

> 说明：agents 相关文档详见 `CLAUDE.md`。此清单按 P0/P1 优先级、关键决策、风险与度量，以及里程碑组织，作为后续执行蓝图。

## 6 周 v1 闭环场景（唯一路径）

- [ ] 从模板创建一个三节点示例 DAG（输入 → 转换 → 输出），在 Console 中运行；查看实时日志与 Trace；引入一次可控失败（类型不匹配或缺失参数），通过 Inspector 修复并重跑直至成功；保存为“发布版本”并生成差异记录。

### 三项最优先投入（保证闭环顺滑）

1. 一体化 Console 与全局状态（含全局搜索/命令面板）
2. 大图性能与可操作性（虚拟化、自动布局、状态过滤、选区重跑）
3. 可观察性与 Trace（日志联动、OTel 关联 id、可点击进度条）

## TODO

### P0（先做，它们最影响可用性）

- [ ] 一体化 Console 与全局状态
  - [ ] 统一运行面板/错误修复/测试为 Console
  - [ ] 顶部全局状态条（当前 run、用时、成功率、缓存命中、活跃日志源）
  - [ ] ⌘K 命令面板与全局搜索（节点/日志/Artifact/参数）

- [ ] 大图性能与可操作性
  - [ ] 节点/边虚拟化与惰性渲染
  - [ ] 子图/分组折叠（按标签或子流程）
  - [ ] 自动布局（elkjs）
  - [ ] 状态过滤（只看 failed/running）
  - [ ] 框选批量操作与“选区重跑”

- [ ] 迁移向导进阶（双向一致性的护栏）
  - [ ] 自动映射置信度标签（高/中/低）与原因说明
  - [ ] 批量规则：同名字段全局映射、正则/路径表达式批处理
  - [ ] 模拟运行（no-op）预估受影响节点数与失败风险
  - [ ] 撤销/审计：每步入事件流，可逐步回滚

- [ ] 强类型与校验
  - [ ] 为 DSL 维护 JSON Schema / TS 类型
  - [ ] Inspector 表单即时校验
  - [ ] outputs 变更触发兼容性判定（breaking / non-breaking / unsafe），在事件流显式提示

- [ ] 版本与分支
  - [ ] 保存即新版本（备注、差异视图：代码/DSL/映射/配置）
  - [ ] 草稿分支与“发布版本”分离
  - [ ] 对比视图一键回滚

- [ ] 可观察性与 Trace
  - [ ] Trace 进度条可点击跳转节点
  - [ ] 日志级别过滤、书签、跳至最新/锁定滚动
  - [ ] 为 run/节点打上 OpenTelemetry 关联 id，日志—事件—节点三向联动

### P1（随后做，提升开发者幸福感）

- [ ] 代码页（Monaco + LSP）
  - [ ] LSP/格式化/诊断；`# outputs:` 片段有 snippet 生成器
  - [ ] 保存前预检（类型与引用完整性）

- [ ] 错误修复 Agent 安全落地
  - [ ] 提示模板：失败节点代码 + 最近 N 行日志 + 输入切片
  - [ ] 分块补丁可选择性应用
  - [ ] Dry-Run 沙箱（隔离依赖/密钥）

- [ ] Inspector 可视化数据血缘
  - [ ] 入参来源标注（常量/上游/表达式），一键复制路径
  - [ ] 显示采样数据与类型

- [ ] 键盘无障碍
  - [ ] 完整快捷键映射（Space 运行/暂停、R 重跑当前、F 聚焦失败、G 跳转 Graph）
  - [ ] 状态色对比度校验

- [ ] Artifact 体验
  - [ ] 时间线/表格视图、常见类型内联预览
  - [ ] 失效策略与批量下载

- [ ] 首次体验与空态引导
  - [ ] 示例 DAG、迁移向导 demo、常见错误修复指引

### 关键产品决策（尽早对齐）

- [ ] DAG 规模目标：是否必须支持千级节点（影响虚拟化与数据加载策略）
- [ ] 并发编辑与锁：多人协作冲突合并与“热区锁”
- [ ] 权限与发布流：API/MCP 发布权限、审阅与回滚策略
- [ ] 日志与 Artifact 保留：配额/清理策略，下载网关
- [ ] 密钥与环境：配置与代码分离，按作用域注入
- [ ] 缓存键策略：命中可视化解释，防污染（命名冲突/输入哈希化）

### 风险与防线

- [ ] 大图渲染/布局抖动 → 虚拟化 + 增量布局 + skeleton
- [ ] 双向编辑竞态（Graph/Inspector/DSL）→ 单一数据源 + 原子事务 + 变更队列
- [ ] Agent“幻觉式修复” → 上下文约束 + Dry-Run + 最小权限沙箱
- [ ] 版本爆炸 → 草稿合并策略 + 过期清理 + 版本备注必填
- [ ] 日志洪泛/浏览器内存 → 流控、分片加载、按级别采样

### 度量（衡量是否“对”）

- [ ] 首个成功运行用时（TTFSR）
- [ ] 迁移通过率
- [ ] 自动映射命中率
- [ ] 失败后一次修复成功率
- [ ] 首屏渲染 < 1.5s
- [ ] 90% 交互 < 100ms

### 里程碑建议

- [ ] M1：编排与运行（Graph/Inspector/Console 基础、WS 事件流、最小 Trace）
- [ ] M2：调试与可观测（日志联动、状态过滤、全局搜索/命令面板）
- [ ] M3：迁移向导 v1（节点级 + 字段级、撤销与事件流）
- [ ] M4：Agent 修复 & 测试（Dry-Run、补丁分块、内置测试套件）
